<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Live Color</title>

  <link rel="stylesheet" type="text/css" href="src/style.css">

  <meta name="theme-color" content="#24292e">
</head>

<body>
    <svg class="sprite" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <symbol id="code" viewBox="0 0 14 16">
        <!-- Icon from GitHub Octicons - https://github.com/primer/octicons/ -->
        <path d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3 9.5 3ZM4.5 3L0 8 4.5 13 6 11.5 2.5 8 6 4.5 4.5 3 4.5 3Z"/>
      </symbol>

      <symbol id="heart" viewBox="0 0 12 16">
        <!-- Icon from GitHub Octicons - https://github.com/primer/octicons/ -->
        <path d="M11.2 3C10.68 2.37 9.95 2.05 9 2 8.03 2 7.31 2.42 6.8 3 6.29 3.58 6.02 3.92 6 4 5.98 3.92 5.72 3.58 5.2 3 4.68 2.42 4.03 2 3 2 2.05 2.05 1.31 2.38 0.8 3 0.28 3.61 0.02 4.28 0 5 0 5.52 0.09 6.52 0.67 7.67 1.25 8.82 3.01 10.61 6 13 8.98 10.61 10.77 8.83 11.34 7.67 11.91 6.51 12 5.5 12 5 11.98 4.28 11.72 3.61 11.2 2.98L11.2 3Z"/>
      </symbol>
    </defs>
  </svg>

  <header></header>

  <div class="container limit">
    <video id="video" class="center" autoplay></video>
  </div>

  <footer>
    <a href="https://github.com/catdad">
      <span class="icon">
        <svg class="icon"><use xlink:href="#code"></use></svg>
      </span>
      <span> with </span>
      <span class="icon">
        <svg class="icon"><use xlink:href="#heart"></use></svg>
      </span>
      <span> by <b>catdad</b></span>
    </a>
  </footer>

  <script>
    var video = document.querySelector('#video');

    function handleStream (source) {
      video.srcObject = source;
    }

    navigator.mediaDevices.enumerateDevices()
    .then(function (devices) {
      var sourceId = null;

      console.log(devices);

      // enumerate all devices all array-like
      [].forEach.call(devices, function (device) {
        // we don't care about non-video
        if (device.kind !== 'videoinput') {
          return;
        }

        // use the first one by default
        if (!sourceId) {
          sourceId = device.deviceId;
        }

        // if this is a back camera, use it instead
        // TODO is this actually right? The internet example said yes,
        // but my phone says no.
        if (/back/i.test(device.label || '')) {
          sourceId = device.deviceId;
        }
      });

      // we didn't find any video input
      if (!sourceId) {
        throw new Error('no video input');
      }

      navigator.mediaDevices.getUserMedia({
        video: {
          sourceId: sourceId
        }
      })
      .then(handleStream)
      .catch(err => {
        // TODO remove alert
        alert('error: ' + err.message);
      });
    });
  </script>
</body>

</html>
